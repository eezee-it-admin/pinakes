<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="custom_index" inherit_id="website_crm_partner_assign.index" name="Custom Find Resellers">
        <xpath expr="//div[@id='partner_left']" position="replace">

            <div class="row">

                <div class="col-4 mb32" id="partner_left">
                    <h3 class="nav-header mt16">Sort A-Z</h3>
                    <table class="table table-borderless m-1 p-1">

                        <t t-set="alphabet" t-value="list('ABCDEFGHIJKLMNOPQRSTUVWXYZ')"/>
                        <tr t-foreach="alphabet" t-as="letter" t-if="(alphabet.index(letter) % 4) == 0">
                            <td t-foreach="alphabet[alphabet.index(letter):alphabet.index(letter) + 4]"
                                t-as="table_letter" class="p-1">
                                <a t-att-href="'#anchor_letter_' + table_letter" class="nav-link p-0 smooth-scroll-link">
                                    <t t-esc="table_letter"/>
                                </a>
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="col-lg-3 mt-5">
                    <div class="d-flex p-2">
                        <t t-call="website.pager"/>
                        <form action="" method="get" class="ms-auto">
                            <div class="mb-3">
                                <input t-if="country_all" type="hidden" name="country_all" value="True"/>
                                <input type="text" name="search" class="search-query form-control" placeholder="Search"
                                       t-att-value="searches.get('search', '')"/>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <t t-set="is_search" t-value="request.params.get('search')"/>

            <!-- Partners grouped by the first letter of their name -->
            <t t-if="not is_search">
                <div t-foreach="('A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S',
                    'T', 'U', 'V', 'W', 'X', 'Y', 'Z')" t-as="letter">
                    <t t-set="partners_for_letter"
                       t-value="partners.filtered(lambda p: p.display_name.startswith(letter) and p.grade_id)"/>
                    <t t-if="partners_for_letter">
                        <div t-att-id="'anchor_letter_' + letter" class="mb-4">
                            <h2 class="mt-3">
                                <t t-esc="letter"/>
                            </h2>
                            <div class="row">
                                <t t-foreach="partners" t-as="partner">
                                    <t t-if="partner.display_name.startswith(letter) and partner.grade_id">
                                        <div class="col-lg-3">
                                            <div class="card mb-3">
                                                <div class="card-body">
                                                    <a t-attf-href="/partners/#{slug(partner)}?#{current_grade and 'grade_id=%s&amp;' % current_grade.id}#{current_country and 'country_id=%s' % current_country.id}">
                                                        <span t-field="partner.display_name"/>
                                                    </a>
                                                    <div t-field="partner.website_short_description"/>
                                                    <t t-if="any(p.website_published for p in partner.implemented_partner_ids)">
                                                        <small>
                                                            <a t-attf-href="/partners/#{slug(partner)}#right_column">
                                                                <t t-esc="partner.implemented_partner_count"/>
                                                                reference(s)
                                                            </a>
                                                        </small>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>
                                    </t>
                                </t>
                            </div>
                        </div>
                    </t>
                </div>
            </t>

            <t t-if="is_search">
                <div class="row">
                    <t t-foreach="partners" t-as="partner">
                        <div class="col-lg-3">
                            <div class="card mb-3">
                                <div class="card-body">
                                    <a t-attf-href="/partners/#{slug(partner)}?#{current_grade and 'grade_id=%s&amp;' % current_grade.id}#{current_country and 'country_id=%s' % current_country.id}">
                                        <span t-field="partner.display_name"/>
                                    </a>
                                    <div t-field="partner.website_short_description"/>
                                    <t t-if="any(p.website_published for p in partner.implemented_partner_ids)">
                                        <small>
                                            <a t-attf-href="/partners/#{slug(partner)}#right_column">
                                                <t t-esc="partner.implemented_partner_count"/>
                                                reference(s)
                                            </a>
                                        </small>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </t>

        </xpath>
        <xpath expr="//div[@id='ref_content']" position="replace">
            <div class="col-lg-8 offset-lg-1" id="ref_content">
                <div t-if="not partners">
                    <p>No result found</p>
                </div>
            </div>
        </xpath>
    </template>
</odoo>
